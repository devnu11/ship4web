#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running pre-commit tests and coverage checks..."

# Run lint-staged to test only staged files
npx lint-staged

# Check if any TypeScript files are staged
if git diff --cached --name-only | grep -E '\.(ts|tsx)$'; then
  echo "ğŸ“Š Checking test coverage..."
  
  # Run full coverage check to ensure we maintain 90% threshold
  npm run test:coverage
  
  if [ $? -ne 0 ]; then
    echo "âŒ Coverage check failed. Please ensure tests pass and coverage is above 90%."
    exit 1
  fi
  
  echo "âœ… All tests passed and coverage requirements met!"
else
  echo "â„¹ï¸  No TypeScript files staged, skipping test coverage check."
fi

echo "ğŸš€ Pre-commit checks completed successfully!"